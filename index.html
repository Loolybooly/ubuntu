<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- discord embed -->
    <meta property="og:title" content="Live Ubuntu" />
    <meta property="og:description" content="Play in a live Ubuntu environment" />
    <meta property="og:image" content="https://i.imgur.com/eMrUskh.png" />
    <meta property="og:url" content="https://live-ubuntu.vercel.app" />
    <meta property="og:type" content="website" />
    <link rel="icon" href="https://i.imgur.com/sPxq6s5.png" type="image/png">

    <!-- twitter (NOT X) embed u STUPID elon -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Live Ubuntu" />
    <meta name="twitter:description" content="Play in a live Ubuntu environment" />
    <meta name="twitter:image" content="https://i.imgur.com/eMrUskh.png" />
    <meta name="twitter:url" content="https://live-ubuntu.vercel.app" />
    <meta name="twitter:site" content="@LoolyTunes" />
    <title>Ubuntu 22.04 LTS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&family=Ubuntu+Mono&display=swap');

        * { box-sizing: border-box; user-select: none; }
        body {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            overflow: hidden;
            font-family: 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #5E2750 0%, #E95420 50%, #77216F 100%);
            background-size: cover;
            display: flex; flex-direction: column;
            color: #eee;
        }

        #mobile-block {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background-color: #300a24; z-index: 10000;
            display: none;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center; color: #E95420; padding: 20px;
        }
        #mobile-block h1 { font-size: 24px; margin-bottom: 10px; }
        #mobile-block p { color: #fff; }

        
        #top-bar {
            height: 32px; background-color: #1d1d1d; display: flex;
            align-items: center; padding: 0 10px;
            font-size: 14px; font-weight: 500; z-index: 2000;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3); position: relative;
        }
        .top-center { position: absolute; left: 50%; transform: translateX(-50%); cursor: default; }
        .top-right-pill { position: absolute; right: 10px; display: flex; align-items: center; padding: 2px; }
        .pill-section {
            padding: 4px 10px; cursor: pointer; border-radius: 15px;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .pill-section:hover, .pill-section.active { background-color: #4a4a4a; }

        
        #power-menu {
            position: absolute; top: 38px; right: 60px; width: 200px;
            background-color: #333; border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6); display: none;
            flex-direction: column; padding: 8px; border: 1px solid #444; z-index: 3000;
        }
        #power-menu.show { display: flex; }
        .menu-item {
            padding: 8px 12px; border-radius: 6px; cursor: pointer;
            display: flex; align-items: center; gap: 10px; font-size: 14px;
        }
        .menu-item:hover { background-color: #E95420; color: white; }

        #toast {
            position: absolute; top: 50px; left: 50%; transform: translateX(-50%);
            background: #333; color: #fff; padding: 10px 20px;
            border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            opacity: 0; pointer-events: none; transition: 0.3s; z-index: 4000;
            border: 1px solid #555; font-size: 14px;
        }

        
        #dock {
            position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
            width: 64px; background-color: rgba(23, 23, 23, 0.95);
            border-radius: 16px; display: flex; flex-direction: column; align-items: center;
            padding: 10px 0; gap: 12px; z-index: 1000;
            box-shadow: 2px 2px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05);
        }
        .dock-icon {
            width: 48px; height: 48px; cursor: pointer; transition: 0.2s; position: relative;
            display: flex; justify-content: center; align-items: center;
        }
        .dock-icon:hover { transform: scale(1.1); background: rgba(255,255,255,0.1); border-radius: 10px; }
        .dock-icon.active::before {
            content: ''; position: absolute; left: -6px; top: 50%; transform: translateY(-50%);
            width: 4px; height: 4px; background: #E95420; border-radius: 50%; box-shadow: 0 0 4px #E95420;
        }

        
        #desktop { flex-grow: 1; position: relative; width: 100%; height: 100%; }
        .window {
            position: absolute; background-color: #fafafa;
            border-radius: 8px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
            min-width: 300px; min-height: 200px; border: 1px solid rgba(0,0,0,0.3);
        }
        .window.maximized {
            top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important;
            border-radius: 0;
        }
        .window.maximized .resizer { display: none; }
        .window-header {
            height: 38px; background-color: #e4e4e4; border-bottom: 1px solid #dcdcdc;
            display: flex; align-items: center; justify-content: center;
            color: #333; font-weight: 700; font-size: 14px; cursor: default;
            border-radius: 8px 8px 0 0;
        }
        .window.dark-mode .window-header { background: #2c2c2c; color: #ddd; border-bottom: 1px solid #111; }
        .window.dark-mode { background: #300a24; border: 1px solid #000; }
        .controls { position: absolute; right: 10px; display: flex; gap: 8px; }
        
        .ctrl-btn {
            width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 10px; cursor: pointer; color: #555;
            background: #dcdcdc; border: 1px solid #ccc;
        }
        .min-btn { font-weight: bold; font-size: 14px; padding-bottom: 0; }
        .close-btn:hover { background: #E95420; color: white; border-color: #b3360b; }
        .window-content { flex-grow: 1; position: relative; overflow: auto; display: flex; flex-direction: column; background: #fff; }
        .window.dark-mode .window-content { background: #300a24; }

        
        .resizer { position: absolute; z-index: 100; }
        .res-n { top: -5px; left: 5px; right: 5px; height: 8px; cursor: n-resize; }
        .res-s { bottom: -5px; left: 5px; right: 5px; height: 8px; cursor: s-resize; }
        .res-e { top: 5px; bottom: 5px; right: -5px; width: 8px; cursor: e-resize; }
        .res-w { top: 5px; bottom: 5px; left: -5px; width: 8px; cursor: w-resize; }
        .res-ne { top: -5px; right: -5px; width: 15px; height: 15px; cursor: ne-resize; z-index: 101; }
        .res-nw { top: -5px; left: -5px; width: 15px; height: 15px; cursor: nw-resize; z-index: 101; }
        .res-se { bottom: -5px; right: -5px; width: 15px; height: 15px; cursor: se-resize; z-index: 101; }
        .res-sw { bottom: -5px; left: -5px; width: 15px; height: 15px; cursor: sw-resize; z-index: 101; }

        
        .terminal-bg {
            background-color: #300a24; color: #f0f0f0;
            font-family: 'Ubuntu Mono', monospace; padding: 10px; font-size: 15px;
            height: 100%; width: 100%; cursor: text;
            overflow-y: auto; display: block;
        }
        .prompt { color: #8ae234; font-weight: bold; }
        .path { color: #729fcf; font-weight: bold; }
        .t-input {
            background: transparent; border: none; color: white;
            font-family: inherit; font-size: inherit; outline: none; 
            width: 80%; margin-left: 5px;
        }

        .files-grid { padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; }
        .file-item {
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
            padding: 10px; border-radius: 5px;
        }
        .file-item:hover { background-color: #e4e4e4; }
        .file-icon { width: 50px; height: 60px; background: #ddd; position: relative; border-radius: 2px; }
        .file-icon::before { content: '</>'; position: absolute; top:50%; left:50%; transform: translate(-50%, -50%); color: #666; font-weight:bold; }
        .file-icon::after { content:''; position: absolute; top:0; right:0; border-width: 0 15px 15px 0; border-style: solid; border-color: #ccc #fff; display:block; width:0; }
        .file-name { margin-top: 8px; font-size: 13px; color: #333; text-align: center; word-break: break-all; }

        .editor-toolbar {
            height: 36px; background: #f1f1f1; border-bottom: 1px solid #ccc;
            display: flex; align-items: center; padding: 0 10px; gap: 10px;
        }
        .editor-btn {
            padding: 4px 12px; background: #fff; border: 1px solid #ccc; border-radius: 4px;
            font-size: 13px; cursor: pointer; color: #333;
        }
        .editor-btn:hover { background: #E95420; color: #fff; border-color: #E95420; }
        .editor-area {
            flex-grow: 1; border: none; padding: 10px;
            font-family: 'Ubuntu Mono', monospace; font-size: 14px; color: #333; resize: none; outline: none;
            background: #fff; white-space: pre; overflow: auto;
        }
        .ff-bar {
            background: #f0f0f4; border-bottom: 1px solid #ccc;
            padding: 6px; display: flex; align-items: center; gap: 10px; height: 36px;
        }
        .ff-url {
            flex-grow: 1; background: #fff; border: 1px solid #ccc; border-radius: 4px;
            padding: 3px 10px; font-size: 13px; color: #333; height: 26px;
        }

        #screensaver {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: black; z-index: 9999; display: none;
            color: #333; align-items: center; justify-content: center; font-size: 20px;
            flex-direction: column;
        }
        .lock-screen {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 20px; color: white; font-family: 'Ubuntu', sans-serif;
        }
        .lock-input {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3);
            border-radius: 5px; padding: 12px 15px; font-size: 16px; color: white;
            width: 250px; outline: none; text-align: center;
        }
        .lock-input::placeholder { color: rgba(255,255,255,0.6); }
        .lock-hint { font-size: 14px; opacity: 0.8; }
    </style>
</head>
<body>
    <div id="mobile-block">
        <h1>⛔ Access Denied</h1>
        <p>This is Ubuntu Desktop, not Ubuntu mobile, go away.</p>
    </div>

    <div id="screensaver">
        <div class="lock-screen">
            <input type="password" class="lock-input" id="lock-input" placeholder="Password" autocomplete="off">
            <div class="lock-hint">Hint: </div>
            <div class="lock-hint">(Yes, theres intentionally no hint.)</div>
        </div>
    </div>
    <div id="toast"></div>

    <div id="top-bar">
        <a href="https://tunes.is-a.dev" target="_blank" style="text-decoration: none;">
            <button style="
                background: linear-gradient(135deg, #5E2750 0%, #E95420 50%, #77216F 100%);
                color: white;
                border: none;
                border-radius: 20px;
                padding: 6px 12px;
                font-size: 12px;
                font-weight: bold;
                cursor: pointer;
                box-shadow: 0 2px 8px rgba(89, 42, 80, 0.3), 0 0 15px rgba(233, 84, 32, 0.2);
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 6px;
                margin-left: -8px;
            " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(89, 42, 80, 0.5), 0 0 20px rgba(233, 84, 32, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(89, 42, 80, 0.3), 0 0 15px rgba(233, 84, 32, 0.2)'">
                My socials and projects
            </button>
        </a>
        <div class="top-center" id="clock">Oct 26 12:00:00</div>
        <div class="top-right-pill">
            <div class="pill-section" id="wifi-btn">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="white" style="pointer-events:none;"><path d="M12 2C7.3 2 3 3.9 0 7l12 15 12-15c-3-3.1-7.3-5-12-5z"/></svg>
            </div>
            <div class="pill-section" id="power-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="pointer-events: none;">
                <path d="M12 2v10M18.4 6.6a9 9 0 1 1-12.8 0"/>
              </svg>
            </div>
        </div>
        <div id="power-menu">
            <div class="menu-item" onclick="triggerSleep()">Sleep</div>
            <div class="menu-item" onclick="location.reload()">Restart</div>
            <div class="menu-item" onclick="triggerShutdown()">Power Off</div>
            <div class="menu-item" onclick="window.open('wallpaper.png')">Get wallpaper</div>
        </div>
    </div>

    <div id="dock">
        <div class="dock-icon" id="dock-firefox" onclick="openWindow('firefox')">
            <img src="https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/png/firefox.png" style="width:85%; height:85%; object-fit:contain;">
        </div>
        <div class="dock-icon" id="dock-files" onclick="openWindow('files')">
            <svg viewBox="0 0 100 100" style="width:80%; height:80%;">
                <path d="M10 25 L35 25 L45 15 L90 15 C95 15 95 20 95 25 L95 85 C95 90 90 95 85 95 L15 95 C10 95 5 90 5 85 L5 30 C5 25 10 25 10 25 Z" fill="#E95420"/>
                <rect x="15" y="35" width="70" height="50" fill="#fff" opacity="0.8" rx="5"/>
            </svg>
        </div>
        <div class="dock-icon" id="dock-terminal" onclick="openWindow('terminal')">
            <svg viewBox="0 0 100 100" style="width:80%; height:80%;">
                <rect x="5" y="5" width="90" height="90" rx="15" fill="#3e3e3e" />
                <text x="50" y="65" font-size="50" text-anchor="middle" fill="#fff" font-family="monospace" font-weight="bold">&gt;_</text>
            </svg>
        </div>
        <div class="dock-icon" id="dock-disks" onclick="openWindow('disks')">
            <svg viewBox="0 0 100 100" style="width:80%; height:80%;">
                <rect x="10" y="10" width="80" height="80" rx="10" fill="#bbb" />
                <circle cx="50" cy="50" r="25" fill="#E95420" />
                <circle cx="50" cy="50" r="10" fill="#fff" />
            </svg>
        </div>
        <div class="dock-icon" id="dock-editor" onclick="openWindow('editor')">
            <svg viewBox="0 0 100 100" style="width:80%; height:80%;">
                <rect x="15" y="10" width="70" height="80" fill="#fff"/>
                <rect x="25" y="20" width="50" height="5" fill="#ccc"/>
                <rect x="25" y="35" width="50" height="5" fill="#ccc"/>
                <text x="50" y="70" font-size="30" text-anchor="middle">TXT</text>
            </svg>
        </div>
    </div>

    <div id="desktop"></div>

    <script>
        (function checkMobile() {
            const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());
            if (isMobile || window.innerWidth < 768) {
                document.getElementById('mobile-block').style.display = 'flex';
            }
        })();

        function updateClock() {
            const now = new Date();
            const date = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            const time = now.toLocaleTimeString('en-US', { hour12: false }); 
            document.getElementById('clock').innerText = `${date},      ${time}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        const powerBtn = document.getElementById('power-btn');
        const wifiBtn = document.getElementById('wifi-btn');
        const powerMenu = document.getElementById('power-menu');
        const toast = document.getElementById('toast');

        powerBtn.addEventListener('mousedown', (e) => {
            e.stopPropagation(); powerMenu.classList.toggle('show'); powerBtn.classList.toggle('active');
        });
        wifiBtn.addEventListener('mousedown', (e) => {
            e.stopPropagation(); toast.innerText = "Ethernet connected, no need for wifi"; toast.style.opacity = '1'; toast.style.top = '60px';
        });
        window.addEventListener('mousedown', (e) => {
            if (!powerMenu.contains(e.target) && e.target !== powerBtn) {
                powerMenu.classList.remove('show'); powerBtn.classList.remove('active');
            }
            if (e.target !== wifiBtn) { toast.style.opacity = '0'; toast.style.top = '50px'; }
        });

        function triggerSleep() {
            document.getElementById('screensaver').style.display = 'flex';
            const lockInput = document.getElementById('lock-input');
            lockInput.value = '';
            lockInput.focus();
        }
        function wakeUp() { document.getElementById('screensaver').style.display = 'none'; }

        function initLockScreen() {
            const lockInput = document.getElementById('lock-input');
            lockInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    wakeUp();
                }
            });
        }
        initLockScreen();
        function triggerShutdown() {
            document.body.innerHTML = ''; document.body.style.background = '#000'; window.close();
        }

        let vfs = {};
        function initVFS() {
            const saved = localStorage.getItem('ubuntu_vfs');
            if (saved) { vfs = JSON.parse(saved); } 
            else { vfs = {}; }
            
            if (vfs['index.html'] === undefined) vfs['index.html'] = document.documentElement.outerHTML.replace(/</g, '&lt;');
            if (vfs['notes.txt'] === undefined) vfs['notes.txt'] = 'Buy milk\nInstall Linux\nDelete Windows';
            if (vfs['sigma.txt'] === undefined) vfs['sigma.txt'] = 'If you see this you are probably a human that knows what sigma is. Congrats, now shutdown the website. Or else...';

            localStorage.setItem('ubuntu_vfs', JSON.stringify(vfs));
        }
        initVFS();

        function saveVFSToStorage() {
            localStorage.setItem('ubuntu_vfs', JSON.stringify(vfs));
            const grids = document.querySelectorAll('.files-grid');
            grids.forEach(g => g.innerHTML = generateFileGrid());
        }

        let highestZ = 100;
        let appInstances = { terminal: 0, files: 0, disks: 0, editor: 0, firefox: 0 };

        function openWindow(app, arg) {
            const existingWindows = document.querySelectorAll(`.window.app-${app}`);
            let foundMinimized = false;
            
            for(let w of existingWindows) {
                if (w.style.display === 'none') {
                    w.style.display = 'flex';
                    highestZ++;
                    w.style.zIndex = highestZ;
                    foundMinimized = true;
                    if (app === 'editor' && arg) {
                        const textArea = w.querySelector('textarea');
                        if(textArea) {
                            textArea.value = vfs[arg] || '';
                            const status = w.querySelector('span[id^="editor-status"]');
                            if(status) status.innerText = 'Editing: ' + arg;
                            const btn = w.querySelector('.editor-btn');
                            const idParts = textArea.id.split('-');
                            const uid = idParts[2];
                            btn.setAttribute('onclick', `saveFile('${uid}', '${arg}')`);
                        }
                    }
                    return; 
                }
            }

            highestZ++; appInstances[app]++;
            document.getElementById(`dock-${app}`).classList.add('active');
            const winId = `win-${app}-${Date.now()}`;
            const win = document.createElement('div');
            win.classList.add('window', `app-${app}`);
            win.id = winId; win.style.zIndex = highestZ;
            const offset = Math.floor(Math.random() * 50);
            win.style.left = (100 + offset) + 'px'; win.style.top = (50 + offset) + 'px';
            win.addEventListener('mousedown', () => { highestZ++; win.style.zIndex = highestZ; });

            let content = '', title = '';
            if(app === 'terminal') {
                title = 'Terminal'; win.classList.add('dark-mode');
                win.style.width = '700px'; win.style.height = '450px';
                const termId = Date.now();
                content = `
                    <div class="terminal-bg" id="t-bg-${termId}" onclick="document.getElementById('t-in-${termId}').focus()">
                        <div id="t-hist-${termId}"><div>Welcome to Ubuntu 22.04 LTS</div><br></div>
                        <div style="display:flex;"><span class="prompt">user@ubuntu</span>:<span class="path">~</span>$ <input class="t-input" id="t-in-${termId}" autocomplete="off" autofocus></div>
                    </div>`;
                setTimeout(() => initTerminal(termId), 0);
            } else if (app === 'files') {
                title = 'Files'; win.style.width = '600px'; win.style.height = '400px';
                content = `<div class="window-content"><div class="files-grid">${generateFileGrid()}</div></div>`;
            } else if (app === 'editor') {
                title = 'Text Editor'; win.style.width = '600px'; win.style.height = '450px';
                const fileContent = (arg && vfs[arg] !== undefined) ? vfs[arg] : '';
                const fileName = arg || '';
                const uniqueEditorId = Date.now();
                content = `
                    <div class="window-content" style="display:flex; flex-direction:column;">
                        <div class="editor-toolbar">
                            <button class="editor-btn" onclick="saveFile('${uniqueEditorId}', '${fileName}')">Save</button>
                            <span id="editor-status-${uniqueEditorId}" style="font-size:12px; color:#666;">${fileName ? 'Editing: ' + fileName : 'New File'}</span>
                        </div>
                        <textarea class="editor-area" id="editor-area-${uniqueEditorId}">${fileContent}</textarea>
                    </div>`;
            } else if (app === 'disks') {
                title = 'Disks'; win.style.width = '450px'; win.style.height = '300px';
                const bytes = new Blob([document.documentElement.outerHTML]).size;
                const kb = (bytes / 1024).toFixed(2);
                const percent = Math.max(1, (kb / 1024) * 100); 
                content = `
                    <div class="window-content" style="padding:20px; background:#f5f5f5; color:#333;">
                        <div style="display:flex; gap:20px; align-items:center;">
                             <div style="width:100px; height:100px; background:conic-gradient(#E95420 ${percent}%, #ddd 0); border-radius:50%;"></div>
                             <div><h3>1 MB Volume</h3><p>Used space: ${kb} KB</p><p>Device: /dev/html1</p></div>
                        </div>
                    </div>`;
                } else if (app === 'firefox') {
                title = 'Mozilla Firefox'; win.style.width = '800px'; win.style.height = '500px';
                const videoId = `vid-${Date.now()}`;
                content = `
                    <div class="window-content" style="display:flex; flex-direction:column; background:#000;">
                        <div class="ff-bar"><span style="cursor:pointer">←</span> <span style="cursor:pointer">→</span> <span style="cursor:pointer">⟳</span><div class="ff-url">https://www.youtube.com/watch?v=dQw4w9WgXcQ</div></div>
                        <video id="${videoId}" style="flex-grow:1; width:100%; height:100%; object-fit:contain; background:#000;" autoplay controls>
                            <source src="https://ia800300.us.archive.org/17/items/Rick_Astley_Never_Gonna_Give_You_Up/Rick_Astley_Never_Gonna_Give_You_Up.mp4" type="video/mp4">
                        </video>
                    </div>`;
                
                setTimeout(() => {
                    const vid = document.getElementById(videoId);
                    if (vid) {
                        vid.play().catch(err => console.log('Autoplay blocked:', err));
                    }
                }, 100);
            }

            const header = document.createElement('div');
            header.classList.add('window-header');
            header.innerHTML = `<div class="controls"><button class="ctrl-btn min-btn" onclick="minWindow('${winId}')">-</button><button class="ctrl-btn close-btn" onclick="closeApp('${app}', '${winId}')">×</button></div>${title}`;

            const contentDiv = document.createElement('div');
            contentDiv.classList.add('window-content');
            contentDiv.innerHTML = content;

            win.appendChild(header);
            win.appendChild(contentDiv);

            const resizers = ['n', 's', 'e', 'w', 'ne', 'nw', 'se', 'sw'];
            resizers.forEach(dir => {
                const resizer = document.createElement('div');
                resizer.classList.add('resizer', `res-${dir}`);
                win.appendChild(resizer);
            });

            document.getElementById('desktop').appendChild(win);
            makeDraggable(win);
            makeResizable(win);
        }

        function generateFileGrid() {
            return Object.keys(vfs).map(f => `<div class="file-item" ondblclick="openWindow('editor', '${f}')"><div class="file-icon"></div><div class="file-name">${f}</div></div>`).join('');
        }

        function saveFile(id, currentName) {
            const content = document.getElementById(`editor-area-${id}`).value;
            let filename = currentName;
            if (!filename) filename = prompt("Enter filename to save:", "untitled.txt");
            if (filename) {
                vfs[filename] = content; saveVFSToStorage();
                document.getElementById(`editor-status-${id}`).innerText = "Saved: " + filename;
                const win = document.getElementById(`editor-area-${id}`).closest('.window');
                win.querySelector('.editor-btn').setAttribute('onclick', `saveFile('${id}', '${filename}')`);
                showToast(`File '${filename}' saved.`);
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast'); t.innerText = msg; t.style.opacity = '1'; t.style.top = '60px';
            setTimeout(() => { t.style.opacity = '0'; t.style.top = '50px'; }, 3000);
        }

        function closeApp(app, winId) {
            const win = document.getElementById(winId); if(win) win.remove();
            appInstances[app]--;
            if (appInstances[app] <= 0) { document.getElementById(`dock-${app}`).classList.remove('active'); appInstances[app] = 0; }
        }
        function minWindow(winId) { document.getElementById(winId).style.display = 'none'; }
        function maxWindow(winId) { document.getElementById(winId).classList.toggle('maximized'); }

        function initTerminal(id) {
            const input = document.getElementById(`t-in-${id}`);
            const history = document.getElementById(`t-hist-${id}`);
            const bg = document.getElementById(`t-bg-${id}`);

            input.addEventListener('keydown', (e) => {
                if(e.key === 'Enter') {
                    const rawLine = input.value.trim();
                    let args = rawLine.split(/\s+/);
                    let cmd = args[0];
                    let isSudo = false;

                    if (cmd === 'sudo') {
                        isSudo = true; args.shift();
                        if (args.length === 0) {
                            history.insertAdjacentHTML('beforeend', `<div>usage: sudo command</div>`);
                            scrollToBottom(); input.value = ''; return;
                        }
                        cmd = args[0];
                    }

                    history.insertAdjacentHTML('beforeend', `<div><span class="prompt">user@ubuntu</span>:<span class="path">~</span>$ ${rawLine}</div>`);
                    input.value = '';

                    if(cmd === 'help') history.insertAdjacentHTML('beforeend', `<div>Available commands: ls, cat, touch, rm, mkdir, nano, cp, mv, whoami, pwd, date, echo, clear, uname</div>`);
                    else if(cmd === 'ls') {
                        const files = Object.keys(vfs).join('  ');
                        if(files) history.insertAdjacentHTML('beforeend', `<div style="color:#eee;">${files}</div>`);
                    }
                    else if(cmd === 'cat') {
                        if(vfs[args[1]] !== undefined) history.insertAdjacentHTML('beforeend', `<div style="white-space:pre-wrap;">${vfs[args[1]].replace(/</g, '&lt;')}</div>`);
                        else history.insertAdjacentHTML('beforeend', `<div>cat: ${args[1]}: No such file</div>`);
                    }
                    else if(cmd === 'touch') {
                        if(args[1]) { vfs[args[1]] = ''; saveVFSToStorage(); history.insertAdjacentHTML('beforeend', `<div>File created.</div>`); }
                        else history.insertAdjacentHTML('beforeend', `<div>touch: missing operand</div>`);
                    }
                    else if(cmd === 'rm') {
                        if (args[1] === '-rf' && args[2] === '/') {
                            if (isSudo) {
                                history.insertAdjacentHTML('beforeend', `<div>[sudo] password for user: </div>`);
                                setTimeout(() => { document.getElementById('screensaver').style.display = 'flex'; window.close(); }, 1000);
                            } else { history.insertAdjacentHTML('beforeend', `<div>rm: cannot remove '/': Permission denied</div>`); }
                        } else if (vfs[args[1]] !== undefined) {
                            delete vfs[args[1]]; saveVFSToStorage(); history.insertAdjacentHTML('beforeend', `<div>File '${args[1]}' removed.</div>`);
                        } else {
                            history.insertAdjacentHTML('beforeend', `<div>rm: ${args[1]}: No such file</div>`);
                        }
                    }
                    else if(cmd === 'mkdir') history.insertAdjacentHTML('beforeend', `<div>Directory created (virtual).</div>`);
                    else if(cmd === 'nano') {
                        if(args[1]) { openWindow('editor', args[1]); history.insertAdjacentHTML('beforeend', `<div>Opening ${args[1]}...</div>`); }
                        else history.insertAdjacentHTML('beforeend', `<div>nano: missing filename</div>`);
                    }
                    else if(cmd === 'clear') history.innerHTML = '';
                    else if(cmd === 'pwd') history.insertAdjacentHTML('beforeend', `<div>/home/user</div>`);
                    else if(cmd === 'whoami') history.insertAdjacentHTML('beforeend', `<div>user</div>`);
                    else if(cmd === 'date') history.insertAdjacentHTML('beforeend', `<div>${new Date().toString()}</div>`);
                    else if(cmd === 'echo') history.insertAdjacentHTML('beforeend', `<div>${args.slice(1).join(' ')}</div>`);
                    else if(cmd === 'uname') history.insertAdjacentHTML('beforeend', `<div>Linux ubuntu 5.15.0-generic x86_64</div>`);
                    else if(cmd === 'cp' || cmd === 'mv') history.insertAdjacentHTML('beforeend', `<div>${cmd}: not implemented in this simulator</div>`);
                    else if(cmd !== '') history.insertAdjacentHTML('beforeend', `<div>${cmd}: command not found</div>`);

                    scrollToBottom();
                }
            });

            function scrollToBottom() {
                window.requestAnimationFrame(() => {
                    bg.scrollTop = bg.scrollHeight;
                });
            }
        }

        function makeDraggable(el) {
            const header = el.querySelector('.window-header');
            let isDragging = false, startX, startY, initialLeft, initialTop;
            header.addEventListener('mousedown', (e) => {
                if(e.target.classList.contains('ctrl-btn')) return;
                isDragging = true; startX = e.clientX; startY = e.clientY; initialLeft = el.offsetLeft; initialTop = el.offsetTop;
            });
            window.addEventListener('mousemove', (e) => {
                if(!isDragging || el.classList.contains('maximized')) return;
                el.style.left = (initialLeft + (e.clientX - startX)) + 'px'; el.style.top = (initialTop + (e.clientY - startY)) + 'px';
            });
            window.addEventListener('mouseup', () => isDragging = false);
        }

        function makeResizable(el) {
            const resizers = el.querySelectorAll('.resizer');
            let currentRes, isRes = false, sW, sH, sX, sY, sL, sT;
            resizers.forEach(r => {
                r.addEventListener('mousedown', (e) => {
                    e.stopPropagation(); currentRes = r; isRes = true; sX = e.clientX; sY = e.clientY;
                    const rect = el.getBoundingClientRect(); sW = rect.width; sH = rect.height; sL = rect.left; sT = rect.top;
                });
            });
            window.addEventListener('mousemove', (e) => {
                if(!isRes) return;
                const dx = e.clientX - sX; const dy = e.clientY - sY; const c = currentRes.classList;
                if(c.contains('res-e') || c.contains('res-ne') || c.contains('res-se')) el.style.width = (sW + dx) + 'px';
                if(c.contains('res-w') || c.contains('res-nw') || c.contains('res-sw')) { el.style.width = (sW - dx) + 'px'; el.style.left = (sL + dx) + 'px'; }
                if(c.contains('res-s') || c.contains('res-se') || c.contains('res-sw')) el.style.height = (sH + dy) + 'px';
                if(c.contains('res-n') || c.contains('res-ne') || c.contains('res-nw')) { el.style.height = (sH - dy) + 'px'; el.style.top = (sT + dy) + 'px'; }
            });
            window.addEventListener('mouseup', () => isRes = false);
        }
    </script>
</body>
</html>
